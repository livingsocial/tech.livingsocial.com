---
layout: post
title: Permanent Link to Simple Google Pie Chart Graph in Rails
author: warren
---
      
					<p>Although there are many comprehensive libraries out there for google graphs in Rails, all we needed was a quick and simple pie chart.  Here’s what we came up with:<br><br><br></p>
<pre>
module ApplicationHelper
  def google_pie_chart(data, options = {})
    options[:width] ||= 250
    options[:height] ||= 100
    options[:colors] = %w(0DB2AC F5DD7E FC8D4D FC694D FABA32 704948 968144 C08FBC ADD97E)
    dt = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-."
    options[:divisor] ||= 1

    while (data.map { |k,v| v }.max / options[:divisor] &gt;= 4096) do
      options[:divisor] *= 10
    end

    opts = {
      :cht =&gt; "p",
      :chd =&gt; "e:#{data.map{|k,v|v=v/options[:divisor];dt[v/64..v/64]+dt[v%64..v%64]}}",
      :chl =&gt; "#{data.map { |k,v| CGI::escape(k + " (#{v})")}.join('|')}",
      :chs =&gt; "#{options[:width]}x#{options[:height]}",
      :chco =&gt; options[:colors].slice(0, data.length).join(',')
    }

    image_tag("http://chart.apis.google.com/chart?#{opts.map{|k,v|"#{k}=#{v}"}.join('&amp;')}")
  rescue
  end
end
</pre>
<p>Here’s an example of how to use it:<br><br><br></p>
<pre>
&lt;%=google_pie_chart([["Very Liberal", 8], ["Liberal", 22], ["Moderate", 9], ["Conservative", 4], ["Very Conservative", 1]], :width =&gt; 626, :height =&gt; 300) %&gt;
</pre>
<p>And what it renders:<br><br><img src="http://chart.apis.google.com/chart?chl=Very+Liberal+%288%29%7CLiberal+%2822%29%7CModerate+%289%29%7CConservative+%284%29%7CVery+Conservative+%281%29&amp;chs=626x300&amp;chco=0DB2AC,F5DD7E,FC8D4D,FC694D,FABA32&amp;cht=p&amp;chd=e:AIAWAJAEAB"></p>
				