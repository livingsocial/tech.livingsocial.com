---
layout: post
title: Permanent Link to Using mocks at the early stage of FB app development
author: val
---
      
					<p>Developing applications for Facebook is a pain. <a href="http://rfacebook.rubyforge.org/tunnel.html">The tunnel approach</a> helps a lot to ease that pain but even then I prefer to start a FB app as a regular application, polish the logic, and then convert it to the Facebook one by adding <span class="caps">FBML</span> and such. At the early stages of the development I have the <em>mocked</em> parameter in <em>config/facebook.yml</em> set to <strong>true</strong> and keep this code in <em>config/initializers/facebook.rb</em>:</p>
<div class="CodeRay">
<div class="code">
<pre><span style="color:#036; font-weight:bold">PERSON_PROFILE_URL</span> = <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">http://www.facebook.com/profile.php</span><span style="color:#710">"</span></span>

<span style="color:#036; font-weight:bold">FACEBOOK_CONFIG</span> = <span style="color:#036; font-weight:bold">YAML</span>.load_file(<span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="background-color:#fff0f0"><span style="color:#710">#{</span><span style="color:#036; font-weight:bold">RAILS_ROOT</span><span style="color:#710">}</span></span><span style="color:#D20">/config/facebook.yml</span><span style="color:#710">"</span></span>)[<span style="color:#036; font-weight:bold">RAILS_ENV</span>] || {}

<span style="color:#080; font-weight:bold">if</span> <span style="color:#036; font-weight:bold">FACEBOOK_CONFIG</span>[<span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">mocked</span><span style="color:#710">'</span></span>]

  <span style="color:#080; font-weight:bold">class</span> <span style="color:#B06; font-weight:bold">Facebook::FBMLController</span>

    require <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">ostruct</span><span style="color:#710">'</span></span>
    <span style="color:#036; font-weight:bold">FB_SESSION</span> = <span style="color:#036; font-weight:bold">OpenStruct</span>.new(<span style="color:#A60">:session_user_id</span> =&gt; <span style="color:#00D; font-weight:bold">1</span>, <span style="color:#A60">:session_key</span> =&gt; <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">12345</span><span style="color:#710">"</span></span>, <span style="color:#A60">:is_valid?</span> =&gt; <span style="color:#038; font-weight:bold">true</span>)

    <span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">fbsession</span>; <span style="color:#036; font-weight:bold">FB_SESSION</span>; <span style="color:#080; font-weight:bold">end</span>

    <span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">require_facebook_install</span>; <span style="color:#038; font-weight:bold">true</span>; <span style="color:#080; font-weight:bold">end</span>

    <span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">redirect_to</span>(url); <span style="color:#080; font-weight:bold">super</span>; <span style="color:#080; font-weight:bold">end</span>

    <span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">url_for</span>(*params); <span style="color:#080; font-weight:bold">super</span>; <span style="color:#080; font-weight:bold">end</span>

  <span style="color:#080; font-weight:bold">end</span>

  <span style="color:#080; font-weight:bold">module</span> <span style="color:#B06; font-weight:bold">Facebook::Acts::FbUser</span>
    <span style="color:#080; font-weight:bold">module</span> <span style="color:#B06; font-weight:bold">InstanceMethods</span>
      <span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">friends</span>
        (<span style="color:#038; font-weight:bold">self</span>.class.find(<span style="color:#A60">:all</span>) - [ <span style="color:#038; font-weight:bold">self</span> ]).collect(&amp;<span style="color:#A60">:uid</span>)
      <span style="color:#080; font-weight:bold">end</span>
    <span style="color:#080; font-weight:bold">end</span>
  <span style="color:#080; font-weight:bold">end</span>

<span style="color:#080; font-weight:bold">end</span></pre>
</div>
</div>
<p>It mocks out just enough of <a href="http://code.google.com/p/facebook-rails/">Facebook on Rails</a> functionality to use <em>FBMLController</em> and <em>acts_as_fb_user</em> from the beginning without Facebook backend.</p>
				