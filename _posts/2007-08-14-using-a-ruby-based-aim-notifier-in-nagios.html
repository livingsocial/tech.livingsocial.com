---
layout: post
title: Permanent Link to Using a ruby-based AIM notifier in nagios
author: val
---
      
					<p>If you use <a href="http://www.nagios.org/">nagios</a> for monitoring of your rails instances, you might want to get notification not only via email or <a href="http://www.sms411.net/2006/07/how-to-send-email-to-phone.html"><span class="caps">SMS</span>-messages</a> but to your <span class="caps">AIM</span> when you are online. The script (<em>libexec/aim_notifier.rb</em>) utilizes the <a href="http://rubyforge.org/projects/net-toc/">Net::TOC</a> gem for sending out notifications:</p>
<div class="CodeRay">
<div class="code">
<pre><span style="color:#888">#!/usr/bin/env ruby</span>

 require <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">rubygems</span><span style="color:#710">'</span></span>
 require <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">net/toc</span><span style="color:#710">'</span></span>

 user = <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">your_bot_name</span><span style="color:#710">'</span></span>
 password = <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">bot_password</span><span style="color:#710">'</span></span>

 msg = <span style="color:#038; font-weight:bold">ARGV</span>[<span style="color:#00D; font-weight:bold">0</span>].to_s.gsub(<span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">\n</span><span style="color:#710">'</span></span>, <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#04D">\n</span><span style="color:#710">"</span></span>)

 client = <span style="color:#036; font-weight:bold">Net</span>::<span style="color:#036; font-weight:bold">TOC</span>.new(user, password)

 client.connect

 sleep <span style="color:#00D; font-weight:bold">3</span>

 buddies = []

 client.buddy_list.each_group { |g, b| buddies = b <span style="color:#080; font-weight:bold">if</span> g == <span style="background-color:#fff0f0"><span style="color:#710">'</span><span style="color:#D20">Friends</span><span style="color:#710">'</span></span> }

 buddies.each <span style="color:#080; font-weight:bold">do</span> |b|
   b.send_im(msg) <span style="color:#080; font-weight:bold">if</span> b.available?
 <span style="color:#080; font-weight:bold">end</span>

 sleep <span style="color:#00D; font-weight:bold">3</span>

 client.disconnect</pre>
</div>
</div>
<p> You need to add any account you want to be notified to bot’s friends (either by logging to <span class="caps">AIM</span> using the bot account or using Net::TOC’s ability to add friends).</p>
<p> The last piece is to add a new notifier in <em>etc/objects/commands.cfg</em> as:</p>
<div class="CodeRay">
<div class="code">
<pre> define command{
         command_name    notify-service-by-aim
         command_line    $USER1$/aim_notifier.rb $ARG1$ $ARG2$ "***** Nagios *****\n\nNotification Ty
 pe: $NOTIFICATIONTYPE$\n\nService: $SERVICEDESC$\nHost: $HOSTALIAS$\nAddress: $HOSTADDRESS$\nState:
 $SERVICESTATE$\n\nDate/Time: $LONGDATETIME$\n\nAdditional Info:\n\n$SERVICEOUTPUT$"
         }</pre>
</div>
</div>
<p> and to append it to the list of notifiers defined for a contact template in <em>etc/objects/commands.cfg</em>:</p>
<div class="CodeRay">
<div class="code">
<pre> service_notification_commands   notify-service-by-email,notify-service-by-aim</pre>
</div>
</div>
<p>Repeat the configuration if you want to use the <span class="caps">AIM</span> notification for hosts as well.</p>
				