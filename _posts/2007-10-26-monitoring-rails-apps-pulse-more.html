---
layout: post
title: Permanent Link to Monitoring Rails Apps:  Pulse + More
author: aaron
---
      
					<p><a href="http://www.pgrs.net/">Paul Gross</a> from <a href="http://www.thoughtworks.com/">Thoughtworks</a> recently created a <a href="http://www.pgrs.net/2007/10/26/announcing-new-gem-pulse">pulse</a> gem. The gem adds a simple action to your rails app, “/pulse”, which acts as a heartbeat.<br><br></p>
<p>The pulse gem currently defines the method as:</p>
<div class="CodeRay">
<div class="code">
<pre><span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">pulse</span>
   render <span style="color:#A60">:text</span> =&gt; <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">OK</span><span style="color:#710">"</span></span>
<span style="color:#080; font-weight:bold">end</span></pre>
</div>
</div>
<p>Then you can configure haproxy to monitor your application by hitting  http://server/pulse and verifying the response is “OK”. <br><br></p>
<p>We’ve had a similar action in our applications for quite some time, although I really like the idea of externalizing it to a gem.  Our implementation is slightly different though.  Since so many rails applications depend on a database, I instead added:</p>
<div class="CodeRay">
<div class="code">
<pre><span style="color:#080; font-weight:bold">def</span> <span style="color:#06B; font-weight:bold">pulse</span>
    rows = <span style="color:#036; font-weight:bold">ActiveRecord</span>::<span style="color:#036; font-weight:bold">Base</span>.connection.execute(<span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">select 1 from dual</span><span style="color:#710">"</span></span>).num_rows <span style="color:#080; font-weight:bold">rescue</span> <span style="color:#00D; font-weight:bold">0</span>
    render <span style="color:#A60">:text</span> =&gt; rows == <span style="color:#00D; font-weight:bold">1</span> ? <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">OK</span><span style="color:#710">"</span></span> : <span style="background-color:#fff0f0"><span style="color:#710">"</span><span style="color:#D20">Error!</span><span style="color:#710">"</span></span>
<span style="color:#080; font-weight:bold">end</span></pre>
</div>
</div>
<p>IIRC, “select 1 from dual” is the fastest query you can run against a database, in MySQL, Oracle, and Postgres.  And if you have mutliple databases, you can add union in the one pulse request, or have multiple actions. <br><br></p>
<p>Now you are not only testing your application is live, but that it can connect to the database.</p>
				